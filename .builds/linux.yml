image: archlinux
packages:
  - go
  - yarn
  - wget
sources:
  - https://git.sr.ht/~avery/crankshaft
artifacts:
  - crankshaft/crankshaft.tar.gz
tasks:
  - setup: |
      cd crankshaft
      go mod download
      cd injected
      yarn install --frozen-lockfile
  - build: |
      cd crankshaft
      make release
      mv .dist "crankshaft-$(git rev-parse --short HEAD)"
      tar -czvf crankshaft.tar.gz "crankshaft-$(git rev-parse --short HEAD)"
